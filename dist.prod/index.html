<!doctype html>
<html class="no-js" lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=0.8">
        <title>Smart Move</title>
        <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700|Lobster+Two:400,700" rel="stylesheet">
        <link rel="stylesheet" href="http://www.whitestrailers.com/bot/css/foundation.css">
        <link rel="stylesheet" href="http://www.whitestrailers.com/bot/css/animate.css">
        <link rel="stylesheet" href="http://www.whitestrailers.com/bot/css/owl.carousel.css">
        <link rel="stylesheet" href="http://www.whitestrailers.com/bot/css//owl.theme.css">
        <link rel="stylesheet" href="http://www.whitestrailers.com/bot/css/app.css">
        <script src="http://www.whitestrailers.com/bot/js/vendor/jquery.js"></script>
        <script src="http://www.whitestrailers.com/bot/js/vendor/pace.min.js"></script>
    </head>
    <body>
        <div class="off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner">
                <div class="title-bar hide-for-medium">
                    <div class="title-bar-left">
                        <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
                        <span class="title-bar-title">Angular Foundation</span>
                    </div>
                </div>
                <div class="off-canvas position-left">
                    <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
                    <ul class="mobile-ofc vertical menu">
                        <li><a href="#getting_started">Getting started</a></li>
                        <li>
                            <a href="#">Directives</a>
                            <ul id="directives-list" class="submenu menu vertical">
                                <li><a href="#accordion">Accordion</a></li><li><a href="#alert">Alert</a></li><li><a href="#buttons">Buttons</a></li><li><a href="#dropdownMenu">Dropdown Menu</a></li><li><a href="#dropdownToggle">Dropdown Toggle</a></li><li><a href="#modal">Modal</a></li><li><a href="#offcanvas">Offcanvas</a></li><li><a href="#pagination">Pagination</a></li><li><a href="#progressbar">Progressbar</a></li><li><a href="#rating">Rating</a></li><li><a href="#tabs">Tabs</a></li><li><a href="#tooltip">Tooltip</a></li>
                            </ul>
                        </li>
                        <li><a href="#animations">Animations</a></li>
                    </ul>
                </div>
                <div class="off-canvas-content">
                    <div class="marketing-topbar show-for-medium">
                        <div class="top-bar-left">
                            <a class="left-off-canvas-toggle menu-icon"><img src="http://www.whitestrailers.com/bot/img/menu.png"></a>
                            <span class="nav-page">Chat</span>
                        </div>
                        <div class="top-bar-middle">
                            <a href="#"><img class="logo animated rubberBand" src="http://www.whitestrailers.com/bot/img/logo.png"></a>
                        </div>

                        <div class="top-bar-right">
                            <a href="#"><img class="search-btn" src="http://www.whitestrailers.com/bot/img/search-icn.png"></a>
                        </div>
                    </div>

                    <div class="header-placeholder"></div>
                    <div role="main">

                        <div class="container">
                            <div class="row">
                                <div id="id_botchathistory" class="columns large-9 medium-9 small-10 chat-area">
                                	<div class="bot-wrapper animated pulse">
                                		<img class="bot-pic" src="http://www.whitestrailers.com/bot/img/bot-pic.png">
                                		<div class="bot">Hello, I'm a bot and my name is Smart Move. I hope you're well today. Looking for a new home? Perhaps I can help. What area are you interested in?
                                		</div>
                                	</div>

                                    <ul class="btn-options hide">
                                        <li>Option 1</li>
                                        <li>Option 2</li>
                                        <li>Option 3</li>
                                    </ul>

                                    <div id="owl-example" class="owl-carousel hide">
                                        <div class="card animated bounceIn">
                                            <img src="http://www.whitestrailers.com/bot/img/house-1.png">
                                            <ul class="card-content">
                                                <li class="house-type"><strong>Detached House | 2 Beds | 2 Baths</strong></li>
                                                <li class="house-desc">16 Forest View, Raheny, Dublin 5</li>
                                                <li class="house-price"><small>€295,000</small></li>
                                            </ul>
                                            <a href="#"><div class="house-btn">VIEW</div></a>
                                        </div>
                                        <div class="card animated bounceIn">
                                            <img src="http://www.whitestrailers.com/bot/img/house-2.png">
                                            <ul class="card-content">
                                                <li class="house-type"><strong>Detached House | 3 Beds | 3 Baths</strong></li>
                                                <li class="house-desc">24 Cherry LaneRaheny, Dublin 5</li>
                                                <li class="house-price"><small>€280,000</small></li>
                                            </ul>
                                            <a href="#"><div class="house-btn">VIEW</div></a>
                                        </div>
                                        <div class="card animated bounceIn">
                                            <img src="http://www.whitestrailers.com/bot/img/house-3.png">
                                            <ul class="card-content">
                                                <li class="house-type"><strong>Detached House | 3 Beds | 3 Baths</strong></li>
                                                <li class="house-desc">11 Wood Avenue, Raheny, Dublin 5</li>
                                                <li class="house-price"><small>€280,000</small></li>
                                            </ul>
                                            <a href="#"><div class="house-btn">VIEW</div></a>
                                        </div>

                                    </div>



                                </div>
                                <div class="columns large-3 medium-3 small-10 right-callout">
                                    <img class="text-center animated slideInDown" src="http://www.whitestrailers.com/bot/img/bot-profile.png" alt="Bot Profile Image">

                                    <p class="text-center animation-time-2 animated fadeIn"><span class="bot-name">Smart Move</span><br><span class="bot-job lobster">Property Bot</span></p>
                                    <p class="text-center animation-time-2 animated fadeIn">The danger of the past was that men became slaves. The danger of the future is that <strong>men may become robots</strong>.</p>

                                    <a class="centered btn-callout animated fadeIn">Mortgage Calculator</a>
                                </div>
                            </div>
                            <div class="row">
                                <div class="columns border large-9 medium-9 small-12 small-centered row-fixed">
                                    <a href="#"><img alt="Simley" class="fake-btn" src="http://www.whitestrailers.com/bot/img/fake-btns.png"></a>
                                    <a href="" class="rnd-btn" onclick="javascript:onChatClick(event)">+</a>
                                    <input id="id_chattext" class="chat-input" type="search" placeholder="Ask Smart Move a question..." autofocus/>


                                </div>
                            </div>
                        </div><!-- /.container -->
                    </div><!-- /.main -->

                    
                    
                    <script src="http://www.whitestrailers.com/bot/js/vendor/smooth-scroll.js"></script>
                    <script src="http://www.whitestrailers.com/bot/js/vendor/owl.carousel.min.js"></script>
                    <script src="http://www.whitestrailers.com/bot/js/vendor/what-input.js"></script>
                    <script src="http://www.whitestrailers.com/bot/js/vendor/foundation.min.js"></script>

                    <script type="text/javascript">


                                        $(document).ready(function () {
                                            smoothScroll.init();

                                            $("#owl-example").owlCarousel({
                                                // Most important owl features
                                                items: 4,
                                                itemsCustom: false,
                                                itemsDesktop: [1000, 1],
                                                itemsDesktopSmall: [980, 3],
                                                itemsTablet: [768, 2],
                                                itemsTabletSmall: false,
                                                itemsMobile: [479, 1],
                                                singleItem: false,
                                                itemsScaleUp: false,
                                                //Basic Speeds
                                                slideSpeed: 200,
                                                paginationSpeed: 800,
                                                rewindSpeed: 1000,
                                                //Autoplay
                                                autoPlay: false,
                                                stopOnHover: false,
                                                // Navigation
                                                navigation: false,
                                                navigationText: ["prev", "next"],
                                                rewindNav: true,
                                                scrollPerPage: false,
                                                //Pagination
                                                pagination: true,
                                                paginationNumbers: false,
                                                // Responsive 
                                                responsive: true,
                                                responsiveRefreshRate: 200,
                                                responsiveBaseWidth: window,
                                                // CSS Styles
                                                baseClass: "owl-carousel",
                                                theme: "owl-theme",
                                                //Lazy load
                                                lazyLoad: false,
                                                lazyFollow: true,
                                                lazyEffect: "fade",
                                                //Auto height
                                                autoHeight: false,
                                                //JSON 
                                                jsonPath: false,
                                                jsonSuccess: false,
                                                //Mouse Events
                                                dragBeforeAnimFinish: true,
                                                mouseDrag: true,
                                                touchDrag: true,
                                                //Transitions
                                                transitionStyle: false,
                                                // Other
                                                addClassActive: false,
                                                //Callbacks
                                                beforeUpdate: false,
                                                afterUpdate: false,
                                                beforeInit: false,
                                                afterInit: false,
                                                beforeMove: false,
                                                afterMove: false,
                                                afterAction: false,
                                                startDragging: false,
                                                afterLazyLoad: false

                                            });


                                            javascriptCheck();
                                            $('#id_contextdump').hide();
                                            $('#id_chattext').bind("enterKey", function (e) {
                                                onChatClick(event);
                                            });
                                            $('#id_chattext').keyup(function (e) {
                                                if (e.keyCode == 13) {
                                                    $(this).trigger("enterKey");
                                                }
                                            });

                                            botInUse = 'Bot';
                                        });

                                        function twitterOK(response) {
                                            console.log(response);
                                        }

                                        function twitterNotOK() {
                                            chat('Error', 'Error whilst attempting to talk to Bot');
                                        }

                                        // if javascript is enabled on the browser then can
                                        // remove the warning message
                                        function javascriptCheck() {
                                            $('#no-script').remove();
                                        }

                                        function createNewDiv(who, message) {

                                        	var text = ""
				                        	if (message instanceof Array) {
				                        		for (var i = 0; i < message.length; i++) {
				                        			text += ' ' + message[i];
				                        		};
				                        	} else {
				                        		text = message;
				                        	}

                                            if (who === 'Bot') {
                                                // function botDelay() {
                                                    return '<div class="bot-wrapper animated pulse"><img class="bot-pic" src="http://www.whitestrailers.com/bot/img/bot-pic.png"><div class="bot">' + text + '</div>';
                                                // }
                                                // return setTimeout(botDelay, 2000);
                                            } else {
                                                return '<div class="human-wrapper animated pulse"><img class="human-pic" src="http://www.whitestrailers.com/bot/img/human-pic.png"><div class="human">' + text + '</div>';
                                            }
                                        }

                                        function chat(person, txt) {
                                            $('#id_botchathistory').append(createNewDiv(person, txt));
                                        }

                                        function processOK(response) {
                                            // console.log(response);

                                            var houses = false;
                                            for (var i=0; i<response.length; i++) {
                                                console.log(response[i]);
                                                console.log(response[i].indexOf('found the following properties'));
                                            	if (response[i].indexOf('found the following properties') !== -1) {
                                            		houses = true;
                                                    if (houses) {
                                                        console.log(response.splice(6,7));
                                                        response = response.splice(0,3).concat(response.splice(6,7));
                                                        break;
                                                    }
                                            	}
                                            }
                                            console.log('response: ' + response);
                                            console.log('houses:' + houses);
                                            if (houses) {
                                                $('#owl-example').show();
                                                chat('Bot', response);
                                            } else {
                                                $('#owl-example').hide();
                                                chat('Bot', response);
                                            }

                                            if (response[0].indexOf('I can look on social media') !== -1) {
                                            	$.get( "https://jornodered.mybluemix.net/tweets", function( data ) {
                                            		var txt = "";
                                            		if (data.rows[1].ave < 0) {
                                            			txt = 'Based on social media, this area has below average sentiment rating';
                                            		} else {
                                            			if (data.rows[1].ave < 4) {
                                            				txt = 'Based on social media, this area has good sentiment rating (sentiment score: ' + data.rows[1].ave + ')';
                                            			} else {
                                            				txt = 'Based on social media, this area has excellemt sentiment rating';
                                            			}
                                            		}
                                            		chat('Bot', txt);
                                            	});

                                            }

                                            if (response[0].indexOf('wake up Chatty') !== -1) {
                                            	botInUse = 'Chatty';
                                            	chat('Bot', "Hi, I'm Chatty the chatbot");	
                                            }
                                            
                                            if(botInUse === 'Chatty') {
                                                $('.chat-area').addClass('ducks');
                                                $('.right-callout').addClass('lego');
                                                $('.bot-name').html('Chatty :)');
                                            }

                                            // $('#id_contextdump').data('convContext', response.botresponse.messageout.context);

                                            var objDiv = $('#id_botchathistory');
                                            if (objDiv.length > 0) {
                                                objDiv[0].scrollTop = objDiv[0].scrollHeight;
                                            }
                                        }

                                        function processNotOK() {
                                            chat('Error', 'Error whilst attempting to talk to Bot');
                                        }

                                        function invokeAjax(message) {
                                            var contextdata = $('#id_contextdump').data('convContext');
                                            console.log('checking stashed context data');
                                            console.log(contextdata);
                                            //var ajaxData = "msgdata=" + message;
                                            var ajaxData = {};
                                            ajaxData.msgdata = message;
                                            if (contextdata) {
                                                ajaxData.context = contextdata;
                                            }

                                            if (botInUse === 'Bot') {
	                                            $.ajax({
	                                                type: 'POST',
	                                                url: 'botchat',
	                                                data: ajaxData,
	                                                success: processOK,
	                                                error: processNotOK
	                                            });                                            	
                                            } else {
	                                            $.ajax({
	                                                type: 'POST',
	                                                url: 'kidchat',
	                                                data: ajaxData,
	                                                success: processOK,
	                                                error: processNotOK
	                                            });	
                                            }
                                        }

                                        // User has entered some text.
                                        function onChatClick(e) {
                                            e.preventDefault();
                                            var txt = $('#id_chattext').val();
                                            chat('You', txt);
                                            invokeAjax(txt);
                                            $('#id_chattext').val('');
                                        }

                    </script>

                    </body>
                    </html>
